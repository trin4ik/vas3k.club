{% extends "layout.html" %}
{% load static %}
{% load text_filters %}

{% block title %}
    –ú–∞—Å—Å–æ–≤—ã–µ –∑–∞–º–µ—Ç–∫–∏ ‚Äî {{ block.super }}
{% endblock %}

{% block content %}

<div class="content">
        <div class="block">
            {% if status == "done" %}
                <span class="block-header">‚úÖ</span>
                <span class="block-description block-description-center">
                    –ó–∞–º–µ—Ç–∫–∞ ¬´{{ note }}¬ª —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–ø–∏—Å–∞–Ω–∞ {{ updated_users|length }} —é–∑–µ—Ä–∞–º. –ú–æ–∂–µ—Ç–µ –∑–∞—Ü–µ–Ω–∏—Ç—å –∏—Ö –≤–Ω–∏–∑—É üëá
                </span>

                <div class="top-users">
                    {% for user in updated_users %}
                        <a href="{% url "profile" user.slug %}" class="top-user top-user-medium zoom-on-hover">
                            <span class="avatar top-user-avatar">
                                <img src="{{ user.get_avatar }}" loading="lazy" />
                            </span>
                            <span class="top-user-name">{{ user.full_name }}</span>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                {% if not achievement and not users %}
                    <form action="." method="get">
                        <span class="block-header">
                            –í–æ–∑—å–º–∏—Ç–µ –≤—Å–µ—Ö —é–∑–µ—Ä–æ–≤ —Å –∞—á–∏–≤–∫–æ–π:
                        </span>
                        <span class="form-row form-row-center">
                            <select name="achievement_code" onchange="this.form.submit()">
                                <option value="">---</option>
                                {% for achievement in achievements %}
                                    <option value="{{ achievement.code }}">{{ achievement.name }}</option>
                                {% endfor %}
                            </select>
                        </span>
                        <span class="block-header">
                            –∏–ª–∏ –≤–ø–∏—à–∏—Ç–µ –∏—Ö –Ω–∏–∫–Ω–µ–π–º—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é:
                        </span>
                        <span class="form-row form-row-center">
                            <textarea name="handpicked_users" placeholder="vas3k,huyastrik,pivastrik"></textarea>
                        </span>
                        <span class="form-row">
                            <input type="submit" value="–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚û°Ô∏è" class="button">
                        </span>
                    </form>
                {% else %}
                    <form action="." method="post">
                        {% csrf_token %}
                        <span class="block-header">
                            –í–æ—Ç —Ç–∞–∫—É—é –∑–∞–º–µ—Ç–∫—É:
                        </span>

                        <span class="form-row form-row-center">
                            <textarea name="note" placeholder="‚ù§Ô∏è" maxlength="100" style="text-align: center;">{{ custom_note|default:achievement.name|default:"" }}</textarea>
                        </span>

                        <span class="block-header">
                            –º—ã —â–∞—Å –ø—Ä–æ–ø–∏—à–µ–º –≤–æ—Ç —ç—Ç–∏–º —é–∑–µ—Ä–∞–º:
                        </span>

                        <div class="top-users">
                            {% for user in users %}
                                <a href="{% url "profile" user.slug %}" class="top-user top-user-medium zoom-on-hover">
                                    <span class="avatar top-user-avatar">
                                        <img src="{{ user.get_avatar }}" loading="lazy" />
                                    </span>
                                    <span class="top-user-name">{{ user.full_name }}</span>
                                </a>
                            {% endfor %}
                        </div>

                        <span class="form-row form-row-center">
                            <label><input type="checkbox" name="only_new" value="1">&nbsp;&nbsp;–ø—Ä–æ–ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ–º, –∫–æ–º—É —è –µ—â–µ –Ω–µ –ø–∏—Å–∞–ª –∑–∞–º–µ—Ç–∫—É —Ä–∞–Ω–µ–µ</label>
                        </span>

                        <span class="form-row form-row-center">
                            <details style="width: 100%; text-align: center;">
                                <summary>–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π —Å–ø–∏—Å–æ–∫</summary>
                                <textarea name="users">{% for user in users %}{{ user.slug }},{% endfor %}</textarea>
                                <small>‚òùÔ∏è –∏–∑ —ç—Ç–æ–≥–æ –ø–æ–ª—è –º–æ–∂–Ω–æ —Ä—É–∫–∞–º–∏ —É–¥–∞–ª–∏—Ç—å –ª—é–¥–µ–π, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å –∑–∞–º–µ—Ç–∫—É</small>
                            </details>
                        </span>

                        <span class="form-row">
                            <input type="submit" value="–ü—Ä–æ–ø–∏—Å—ã–≤–∞–π!" class="button button-red">
                        </span>
                    </form>
                {% endif %}
            {% endif %}
        </div>
</div>
{% endblock %}
